<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <link rel='stylesheet' href='/stylesheets/style.css' />
  <script type="text/javascript">
        function checkPw() {
            var password = document.getElementsByName(oldpassword);
            var pass1 = document.getElementsByName(newpassword);
            var pass2 = document.getElementsByName(repassword);
            checkPassword(password);
            checkEqual(pass1, pass2);
        }

        function checkPassWord(password) {
            var flag = false;
            if (password != "") {
                var reg = /^[a-zA-Z0-9_+-=,.~!@#$%^&*]{8,16}$/
                if (reg.test(password)) {
                    flag = true
                }
            }
            if (!flag) {
                alert('新密码格式不对')
            }
        }

        function checkEqual(pass1, pass2) {
            var flag = false;
            if (pass1 == pass2) {
                flag = true
            }
            if (!flag) {
                alert('两次密码不同')
            }
        }

        function checkEmail(email) {
            checkEmail = function (email) {
                var flag = false
                if (email != "") {
                    var reg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]+$/
                    if (reg.test(email)) {
                        flag = true
                    }
                }
                if (!flag) {
                    alert('邮箱格式不对')
                }
            }
        }
    </script>
</head>

<body>
  <div style="text-align:right;">
    <% if(isLogin) { %>
      <a href="/user"><%= userInfo.username %></a> &nbsp;&nbsp;&nbsp; <a href="/signout">注销</a>
    <% } else { %>
        <a href="/signin">登陆</a> &nbsp;&nbsp;&nbsp; <a href="/signup">注册</a>
    <%}%>
  </div>
  <table>
    <tr>
      <td>用户名</td><td><%= userInfo.username %></td>
    </tr>
    <tr>
      <td>邮箱</td><td><%= userInfo.email %></td>
    </tr>
    <tr>
      <td>注册时间</td><td><%= userInfo.regtime %></td>
    </tr>
    <tr>
      <td>权限</td><td><%= userInfo.role %></td>
    </tr>
  </table>

    <% if(userInfo.message == 1){  %>
      <p>修改密码成功</p>
    <% } else if(userInfo.message == 2){  %>
      <p>修改密码失败</p>
    <% } %>

  <form action="/user/password" method="post">
    <input type="password" name="oldpassword" placeholder="输入原密码" /><br />
    <input type="password" name="newpassword" placeholder="输入新密码" /><br />
    <input type="password" name="repassword" placeholder="重复新密码" /><br />
    <input type="submit" value="修改密码"/>
  </form>
    <% if(userInfo.message == 3){  %>
      <p>修改邮箱成功</p>
    <% } else if(userInfo.message == 4){  %>
      <p>邮箱格式错误</p>
    <% } %>
  <form action="/user/email" method="post">
    <input type="text" name="newemail" placeholder="输入新邮箱"/>
    <input type="submit" value="修改邮箱"/>
  </form>
</body>

</html>